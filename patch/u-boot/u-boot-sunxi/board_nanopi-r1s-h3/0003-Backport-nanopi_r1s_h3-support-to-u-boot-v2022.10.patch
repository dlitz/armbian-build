From f76293fe00774cdab7475c893b0aaa314c032144 Mon Sep 17 00:00:00 2001
From: Darsey Litzenberger <dlitz@dlitz.net>
Date: Tue, 13 Jun 2023 17:43:31 -0600
Subject: [PATCH 3/3] Backport nanopi_r1s_h3 support to u-boot v2022.10

---
 arch/arm/dts/sun8i-h3-nanopi-r1s.dts | 5 +++++
 configs/nanopi_r1s_h3_defconfig      | 2 ++
 2 files changed, 7 insertions(+)

diff --git a/arch/arm/dts/sun8i-h3-nanopi-r1s.dts b/arch/arm/dts/sun8i-h3-nanopi-r1s.dts
index 6212d1ba87..88a7379f0a 100644
--- a/arch/arm/dts/sun8i-h3-nanopi-r1s.dts
+++ b/arch/arm/dts/sun8i-h3-nanopi-r1s.dts
@@ -8,6 +8,11 @@
 #include "sun8i-h3-nanopi.dtsi"
 #include <dt-bindings/leds/common.h>
 
+/* Backport to u-boot v2022.10 */
+#ifndef CLK_OSC32K_FANOUT
+# define CLK_OSC32K_FANOUT 1
+#endif
+
 / {
 	model = "FriendlyElec NanoPi-R1S-H3";
 	compatible = "friendlyelec,nanopi-r1s-h3", "allwinner,sun8i-h3";
diff --git a/configs/nanopi_r1s_h3_defconfig b/configs/nanopi_r1s_h3_defconfig
index 0e2cec75a7..c42c1f81ed 100644
--- a/configs/nanopi_r1s_h3_defconfig
+++ b/configs/nanopi_r1s_h3_defconfig
@@ -8,6 +8,8 @@ CONFIG_DRAM_CLK=408
 CONFIG_MACPWR="PD6"
 CONFIG_USB0_ID_DET="PG12"
 # CONFIG_SYS_MALLOC_CLEAR_ON_INIT is not set
+CONFIG_SPL_STACK=0x8000
+CONFIG_SYS_PBSIZE=1024
 CONFIG_CMD_USB_MASS_STORAGE=y
 CONFIG_CMD_UMS_ABORT_KEYED=y
 CONFIG_LED=y
-- 
2.39.2

